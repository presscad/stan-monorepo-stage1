TEMPLATE_INSTANTIATION := $(shell find src/stan/gm -type f -name '*_inst.cpp')
TEMPLATE_INSTANTIATION += $(shell find src/stan/gm -type f -name '*_def.cpp')
TEMPLATE_INSTANTIATION := $(TEMPLATE_INSTANTIATION:src/%.cpp=bin/%.o)

.PRECIOUS: bin/stanc$(EXE)
bin/stanc$(EXE) : $(TEMPLATE_INSTANTIATION) bin/stan/command/stanc.o bin/libstan.a
	@mkdir -p $(dir $@)
	$(LINK.c) $(OUTPUT_OPTION) $(TEMPLATE_INSTANTIATION) bin/stan/command/stanc.o $(LDFLAGS) 

bin/stan/%.o : src/stan/%.cpp
	@mkdir -p $(dir $@)
	$(COMPILE.c) $(OUTPUT_OPTION) $<


